<div class="photo-header">
  <div class="author-avatar">
    <a routerLink="#">
      <img src="{{ image.userOwnerImgLink }}" />
    </a>
  </div>
  <div class="basic-info">
    <h3>
      <ng-container *ngIf="!titleEditing"
        >{{ image.title
        }}<span (click)="editTitle()" class="edit-delete-icon"
          >E</span
        ></ng-container
      >
      <ng-container *ngIf="titleEditing && image.title !== ''">
        <form [formGroup]="titleForm" (ngSubmit)="approveTitle(titleForm)">
          <input-text
            [data]="{
              label: 'Title'
            }"
            formControlName="title"
          ></input-text>
          <button type="button" (click)="discardTitle()">Discard</button>
          <button type="submit">Submit</button>
        </form>
      </ng-container>
    </h3>
    <span
      >Added {{ image.creationDate }} by
      <a class="author-link" routerLink="/user/{{ image.userId }}">{{
        image.userOwnerName
      }}</a></span
    >
  </div>
  <div class="likes">
    <span (click)="showLiking()" class="like-description"
      >{{ image.likeCount }} likes
    </span>
    <span
      class="like"
      [ngClass]="image.liked === true ? 'liked' : null"
      *ngIf="loggedIn"
    >
      <span *ngIf="!image.liked" (click)="photoLike()">
        Like
      </span>

      <span (click)="photoUnlike()" *ngIf="image.liked">Liked!</span>
    </span>
  </div>
</div>
<div class="centered">
  <div class="hero-img"><img src="{{ image.imgLink }}" /></div>
  <div class="photo">
    <div class="photo-content">
      <div class="comments-wrapper">
        <div class="all-comments">
          <div class="add-comment" *ngIf="loggedIn">
            <form
              #commentUpload="ngForm"
              (ngSubmit)="onCommentUpload(commentUpload)"
            >
              <div class="flex-wrapper">
                <div class="image-author">
                  <div class="avatar-container">
                    <a class="avatar-link" routerLink="">
                      <img src="https://via.placeholder.com/40x40" />
                    </a>
                  </div>
                </div>
                <textarea id="text" name="text" ngModel></textarea>
              </div>
              <div class="warning" *ngIf="this.formValid === false">
                Comment must contains at least 5 letters.
              </div>
              <div class="button-wrapper">
                <span *ngIf="loading" class="loading"
                  ><img src="../../assets/svg/loading.svg"
                /></span>
                <button
                  [disabled]="loading"
                  type="submit"
                  class="button-colored"
                >
                  Send
                </button>
              </div>
            </form>
          </div>

          <p class="comment-title">Comments ({{ image.commentsCount }})</p>

          <div class="comments-group">
            <div *ngFor="let comment of comments" class="comment">
              <div class="image-author">
                <div class="avatar-container">
                  <a
                    class="avatar-link"
                    routerLink="/user/{{ comment.userId }}"
                  >
                    <img src="{{ comment.userOwnerImgLink }}" />
                  </a>
                </div>
              </div>
              <div class="comment-content">
                <div class="header">
                  <h4 class="author">
                    <a routerLink="/user/{{ comment.userId }}">{{
                      comment.userName
                    }}</a>
                  </h4>
                  <p class="content-secondary header-info">
                    {{ comment.creationDate }}
                  </p>
                  <span *ngIf="comment.edited" class="header-info"
                    >(edited)</span
                  >
                  <span
                    class="edit-delete-icon header-info"
                    (click)="removeComment(comment.id)"
                    *ngIf="comment.userId === loggedId"
                  >
                    D
                  </span>
                  <span
                    class="edit-delete-icon header-info"
                    (click)="editComment(comment)"
                    *ngIf="comment.userId === loggedId"
                  >
                    E
                  </span>
                  <span class="likes header-info">
                    <span class="link" (click)="commentShowLiked(comment.id)">
                      {{ comment.likeCount }} likes
                    </span>
                  </span>
                  <span
                    class="like"
                    [ngClass]="comment.liked === true ? 'liked' : null"
                    *ngIf="loggedIn"
                  >
                    <span (click)="commentLike(comment)" *ngIf="!comment.liked">
                      Like
                    </span>
                    <span (click)="commentUnlike(comment)" *ngIf="comment.liked"
                      >Liked!</span
                    >
                  </span>
                </div>
                <p *ngIf="!comment.isEditing">{{ comment.content }}</p>
                <div *ngIf="comment.isEditing">
                  <form
                    #editComment="ngForm"
                    (ngSubmit)="sendEditComment(editComment, comment)"
                  >
                    <textarea
                      name="value"
                      ngModel="{{ comment.content }}"
                    ></textarea>
                    <div class="edit-elements">
                      <div class="warning" *ngIf="comment.editValid === false">
                        Comment must contains at least 5 letters.
                      </div>
                      <span class="discard" (click)="discard(comment)"
                        >Discard</span
                      >
                      <button type="submit">Edit</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="description">
          <p>Description</p>
          <span class="description-content">{{ image.description }}</span>
          <p class="tag-title">Tags</p>
          <span *ngFor="let tag of image.tagsList" class="tag">{{ tag }} </span>
          <span *ngIf="image.tagsList.length === 0">no tags added</span>
        </div>
      </div>
    </div>
  </div>
  <div style="clear:both"></div>
</div>
<app-confirmation-message #msg></app-confirmation-message>
<app-agree-label
  #confirmLabel
  (emitter)="confirm()"
  [message]="'You are going to delete this comment. Are you sure?'"
></app-agree-label>
<app-information-label #label></app-information-label>
